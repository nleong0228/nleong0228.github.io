<!DOCTYPE html>
<!-- saved from url=(0035)https://waaw.csound.com/reverb.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>WebAudio Csound</title>
  <style type="text/css">
  html, 
  body {
    font-family: Monospace;
    color: #bf94f7;
    background-color: #000055;
  }
  #console {
      font-family:  Monospace;
      color: #b5b6ff;
      background-color: #000000;
      font-size: 16px;
      width: 805px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-style: solid;
      padding: 20px 0px;
    }

   H1 {
     font-size: 36px;
   }

   #controls {
      width: 805px;
      font-size: 16px;
      text-align:center
    }

    input[type=range] {
      height: 32px;
      -webkit-appearance: none;
      margin: 10px 0;
      width: 100%;
      background: #000055;
    }

    input[type=range]:focus {
      outline: none;
    }

    input[type=range]::-webkit-slider-runnable-track {
      width: 100%;
      height: 16px;
      cursor: pointer;
      animate: 0.2s;
      box-shadow: 0px 0px 0px #000000;
      background: #b5b6ff;
      border-radius: 25px;
      border: 1px solid #000055;
    }

    input[type=range]::-webkit-slider-thumb {
      box-shadow: 1px 1px 1px #828282;
      border: 1px solid #8A8A8A;
      height: 24px;
      width: 35px;
      border-radius: 6px;
      background: #b5b6ff;
      cursor: pointer;
      -webkit-appearance: none;
      margin-top: -5px;
    }

    input[type=range]:focus::-webkit-slider-runnable-track {
      background: #b5b6ff;
    }

    input[type=range]::-moz-range-track {
      width: 100%;
      height: 16px;
      cursor: pointer;
      animate: 0.2s;
      box-shadow: 0px 0px 0px #000000;
      background: #b5b6ff;
      border-radius: 25px;
      border: 1px solid #000055;
    }

    input[type=range]::-moz-range-thumb {
      box-shadow: 1px 1px 1px #828282;
      border: 1px solid ##b5b6ff;
      height: 24px;
      width: 35px;
      border-radius: 6px;
      background: ##b5b6ff;
      cursor: pointer;
    }

    input[type=range]::-ms-track {
      width: 100%;
      height: 16px;
      cursor: pointer;
      animate: 0.2s;
      background: transparent;
      border-color: transparent;
      color: transparent;
    }

    input[type=range]::-ms-fill-lower {
      background: #b5b6ff;
      border: 1px solid #000055;
      border-radius: 50px;
      box-shadow: 0px 0px 0px #000000;
    }

    input[type=range]::-ms-fill-upper {
      background: #b5b6ff;
      border: 1px solid #000055;
      border-radius: 50px;
      box-shadow: 0px 0px 0px #000000;
    }

    input[type=range]::-ms-thumb {
      margin-top: 1px;
      box-shadow: 1px 1px 1px #828282;
      border: 1px solid #b5b6ff;
      height: 24px;
      width: 35px;
      border-radius: 6px;
      background: #b5b6ff;
      cursor: pointer;
    }

    input[type=range]:focus::-ms-fill-lower {
      background: #b5b6ff;
    }

    input[type=range]:focus::-ms-fill-upper {
      background: #b5b6ff;
    }

   #recButton {
      margin: auto;
      font-family: Monospace;
      width: 805px;
      padding: 10px 0px;
      font-size: 24px;
      background-color: #b5b6ff;
   }
  </style>
  <script src="./WebAudio Csound_files/CsoundObj.js"></script>
  <script>
    let count = 0;
    let csoundObj;
    const TEST_CSD =
    `
    0dbfs = 1
    nchnls = 2

    instr 103
    kf6 chnget "rec"
    ktrig changed kf6
    if ktrig==1 then

    turnoff2 4, 0, 1
    event "i", 3, 0, 3
    endif

    endin

    instr 3



    krelease release
    if krelease==1 then
    event "i", 4, 0, 1000
    endif

    ain inch 1
    andx line 0, p3, ftlen(giBuffer)
    tablew ain, andx, giBuffer

    endin

    instr 4

    chnset 1.0, "grain"
    chnset 1.0, "kstr"

    kf7 chnget "granAmp"
    kf8 chnget "kstr"
    kf9 chnget "grain"
    kf10 chnget "start"

    kfreq = 1
    kgrsize = 1

    iolaps = 2

    kgrsize = 1/kf9
    kfreq = iolaps/kgrsize
    kps = 1/iolaps


    kstr = 1/kf8
    kpitch = 1

    asig syncloop kf7, kfreq, kpitch, kgrsize, kps*kstr, kf10, 2.5, giBuffer, 2, iolaps
    gasrc = gasrc + asig*.5

    endin
    </CsInstruments>
      <CsScore>
      i103 0 36000

    </CsScore>
    </CsoundSynthesizer>
    `;

    CsoundObj.importScripts("./js/").then(() => {
      csoundObj = new CsoundObj();
      csoundObj.enableAudioInput((res) => {
        if (res) {
          csoundObj.setMessageCallback((msg) => {
            var element = document.getElementById('console');
            element.value += "\n" + msg;
            element.scrollTop = 99999; // focus on bottom
            count += 1;
            if (count == 1000) {
              element.value = ' ';
              count = 0;
            }
          });
          document.getElementById('recButton').addEventListener('click',
            click_this);
          document.getElementById('recButton').disabled = false;
          CSOUND_AUDIO_CONTEXT.suspend();
          csoundObj.compileCSD(TEST_CSD);
          csoundObj.start();
        } else {
          alert("Unable to start microphone.");
        }
      });
    });

    var playing = false;

    function click_this() {
      if (playing == false) {
        csoundObj.setControlChannel("rec", 1);
        document.getElementById('recButton').innerText = "off";
        playing = true;
      } else {
        csoundObj.setControlChannel("rec", 0);
        document.getElementById('recButton').innerText = "on";
        playing = false;
      }
    }

    function attachLiisteners() {
      document.getElementById("amp")
      addEventListener("input", SetAmp);
    }

    function SetAmp() {
      SetParam('amp', '', 1., 0.0);
    }

    function SetSeed() {
      SetParam("seed", '', 1., 0.0);
    }

    function SetGrain() {
      SetParam("grain", '', 1., 0.0);
    }

    function SetStart() {
      SetParam("start", '', 0., 5.0);
    }

    function SetParam(name, label, scal, off) {
      var val = document.getElementById(name).value / scal + off;
      csound.setControlChannel(name, val);
      console.log(name + ": " + val + " " + label);
    }

  </script><script src="./WebAudio Csound_files/CsoundNode.js"></script>
</head>

<body>
  <h1>Syncloop</h1>
  <textarea class="console" rows="24" id="console">Csound: loading...</textarea>
  <div id="controls">
    <p>
      <input type="range" name="amplitude" id="amp" step="0.01" value="0.5" min="0" max="1"> amplitude </p>
    <p>
      <input type="range" name="seed" id="seed" step="0.01" value="0.1" min="0" max="1"> seed </p>
    <p>
      <input type="range" name="grain" id="grain" step="0.01" value="0.1" min="0" max="1"> grain size </p>
    <p>
      <input type="range" name="start" id="start" step="0.01" value="1" min="0" max="5"> start point </p>
  </div>
  <p>
    <button id="recButton">record</button>
  </p>



</body></html>