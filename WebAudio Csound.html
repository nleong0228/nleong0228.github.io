<!DOCTYPE html>
<<<<<<< HEAD
<!-- saved from url=(0035)https://waaw.csound.com/canvas.html -->
<html><!--
 csound.js canvas example
 Copyright (C) 2017 V Lazzarini
--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>WebAudio Csound </title>
  <style type="text/css">
  html,
=======
<!-- saved from url=(0035)https://waaw.csound.com/reverb.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>WebAudio Csound</title>
  <style type="text/css">
  html, 
>>>>>>> b5551c6b83c0e6b849c608f8b231c4a50717ac29
  body {
    font-family: Monospace;
    color: #bf94f7;
    background-color: #000055;
  }
<<<<<<< HEAD

  H1 {
    font-size: 36px;
  }


    #cnvs {
      touch-action: none;
      background-color: #bf94f7;
    }

    #messages {
      width: 800px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: Monospace;
    }
  </style>

  <script type="text/javascript" src="./WebAudio Csound_files/csound.js"></script>
  <script type="text/javascript">
    function moduleDidLoad() {
      csound.Play();
      csound.CompileOrc(
        "instr 1 \n" +
        "kfr chnget \"freq\" \n" +
        "kamp chnget \"amp\" \n" +
        "kcf chnget \"cf\" \n" +
        "ka linenr (800-kamp)/800,.01,0.1,0.01 \n" +
        "a1 vco2   ka,440+kfr \n" +
        "kcf port kcf,0.01 \n" +
        "a2 moogvcf a1, kcf*(1+ka), 0.8 \n" +
        "al,ar freeverb a2,a2, 0.3, 0.8 \n" +
        "outs al,ar \n" +
        "endin");
      csound.SetChannel("cf", 1000);
    }

    function handleMessage(message) {
      var cons = document.getElementById("messages");
      cons.innerText = message;
    }

    function main() {
      var cnvs = document.getElementById("cnvs");
      var cons = document.getElementById("messages");
      cons.innerText = "Loading Csound...";
      // called by csound.js
      var playing = false;

      function cnvs_getCoordinates(e) {
        if (playing) {
          var ctx = cnvs.getContext("2d");
          var rect = cnvs.getBoundingClientRect();
          x = e.clientX - rect.left
          y = e.clientY - rect.top
          csound.SetChannel('amp', y);
          csound.SetChannel('freq', x);

          ctx.clearRect(0, 0, cnvs.width, cnvs.height);
          ctx.fillStyle = "#000055";
          ctx.fillRect(x, y, 15, 15);
        }
      }

      var started = false;

      function cnvs_play(e) {
        if (started == false) {
          CSOUND_AUDIO_CONTEXT.resume();
          started = true;
        }
        csound.Event("i1 0 -1");
        csound.SetChannel('cf', 3000);
        var ctx = cnvs.getContext("2d");
        var rect = cnvs.getBoundingClientRect();
        x = e.clientX - rect.left
        y = e.clientY - rect.top
        csound.SetChannel('amp', y);
        csound.SetChannel('freq', x);
        ctx.fillStyle = "#000055";
        ctx.fillRect(x, y, 15, 15);
        playing = true;
      }

      function cnvs_stop(e) {
        csound.Event("i-1 0 -1");
        csound.SetChannel('cf', 1000);
        var ctx = cnvs.getContext("2d");
        ctx.clearRect(0, 0, cnvs.width, cnvs.height);
        playing = false;
      }

      function cnvs_out() {}

      function cnvs_getTCoordinates(e) {
        e.preventDefault();
        if (playing) {
          var ctx = cnvs.getContext("2d");
          var rect = cnvs.getBoundingClientRect();
          touches = e.touches;
          t = touches[0];
          x = t.clientX - rect.left
          y = t.clientY - rect.top
          csound.SetChannel('amp', y);
          csound.SetChannel('freq', x);

          ctx.clearRect(0, 0, cnvs.width, cnvs.height);
          ctx.fillStyle = "#000055";
          ctx.fillRect(x, y, 50, 50);
        }
      }

      var started = false;

      function cnvs_tplay(e) {
        e.preventDefault();
        if (started == false) {
          CSOUND_AUDIO_CONTEXT.resume();
          started = true;
        }
        csound.Event("i1 0 -1");
        csound.SetChannel('cf', 3000);
        var ctx = cnvs.getContext("2d");
        var rect = cnvs.getBoundingClientRect();
        touches = e.touches;
        t = touches[0];
        x = t.clientX - rect.left
        y = t.clientY - rect.top
        csound.SetChannel('amp', y);
        csound.SetChannel('freq', x);
        ctx.fillStyle = "#000055";
        ctx.fillRect(x, y, 50, 50);
        playing = true;
      }

      function cnvs_tstop(e) {
        e.preventDefault();
        csound.Event("i-1 0 -1");
        csound.SetChannel('cf', 1000);
        var ctx = cnvs.getContext("2d");
        ctx.clearRect(0, 0, cnvs.width, cnvs.height);
        playing = false;
      }

      cnvs.addEventListener("touchstart", cnvs_tplay, false);
      cnvs.addEventListener("touchmove", cnvs_getTCoordinates, false);
      cnvs.addEventListener("touchend", cnvs_tstop, false);
      cnvs.addEventListener("mousedown", cnvs_play, false);
      cnvs.addEventListener("mouseup", cnvs_stop, false);
      cnvs.addEventListener("mousemove", cnvs_getCoordinates, false);
    }

    window.oncontextmenu = function(event) {
      event.preventDefault();
      event.stopPropagation();
      return false;
    };
  </script>
<script type="text/javascript" src="./WebAudio Csound_files/CsoundObj.js"></script><script src="./WebAudio Csound_files/CsoundNode.js"></script></head>

<body onload="main()">
  <h1 id="tit">Canvas Synth</h1>
  <p>
    </p><div id="messages">  rtevent:	   T  2.576 TT  2.576 M:  0.32739  0.29987<br></div>
  <p></p>
  <p>
    <canvas class="cnvs " id="cnvs" width="800" height="800"></canvas>
=======
  #console {
      font-family:  Monospace;
      color: #b5b6ff;
      background-color: #000000;
      font-size: 16px;
      width: 805px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-style: solid;
      padding: 20px 0px;
    }

   H1 {
     font-size: 36px;
   }

   #controls {
      width: 805px;
      font-size: 16px;
      text-align:center
    }

    input[type=range] {
      height: 32px;
      -webkit-appearance: none;
      margin: 10px 0;
      width: 100%;
      background: #000055;
    }

    input[type=range]:focus {
      outline: none;
    }

    input[type=range]::-webkit-slider-runnable-track {
      width: 100%;
      height: 16px;
      cursor: pointer;
      animate: 0.2s;
      box-shadow: 0px 0px 0px #000000;
      background: #b5b6ff;
      border-radius: 25px;
      border: 1px solid #000055;
    }

    input[type=range]::-webkit-slider-thumb {
      box-shadow: 1px 1px 1px #828282;
      border: 1px solid #8A8A8A;
      height: 24px;
      width: 35px;
      border-radius: 6px;
      background: #b5b6ff;
      cursor: pointer;
      -webkit-appearance: none;
      margin-top: -5px;
    }

    input[type=range]:focus::-webkit-slider-runnable-track {
      background: #b5b6ff;
    }

    input[type=range]::-moz-range-track {
      width: 100%;
      height: 16px;
      cursor: pointer;
      animate: 0.2s;
      box-shadow: 0px 0px 0px #000000;
      background: #b5b6ff;
      border-radius: 25px;
      border: 1px solid #000055;
    }

    input[type=range]::-moz-range-thumb {
      box-shadow: 1px 1px 1px #828282;
      border: 1px solid ##b5b6ff;
      height: 24px;
      width: 35px;
      border-radius: 6px;
      background: ##b5b6ff;
      cursor: pointer;
    }

    input[type=range]::-ms-track {
      width: 100%;
      height: 16px;
      cursor: pointer;
      animate: 0.2s;
      background: transparent;
      border-color: transparent;
      color: transparent;
    }

    input[type=range]::-ms-fill-lower {
      background: #b5b6ff;
      border: 1px solid #000055;
      border-radius: 50px;
      box-shadow: 0px 0px 0px #000000;
    }

    input[type=range]::-ms-fill-upper {
      background: #b5b6ff;
      border: 1px solid #000055;
      border-radius: 50px;
      box-shadow: 0px 0px 0px #000000;
    }

    input[type=range]::-ms-thumb {
      margin-top: 1px;
      box-shadow: 1px 1px 1px #828282;
      border: 1px solid #b5b6ff;
      height: 24px;
      width: 35px;
      border-radius: 6px;
      background: #b5b6ff;
      cursor: pointer;
    }

    input[type=range]:focus::-ms-fill-lower {
      background: #b5b6ff;
    }

    input[type=range]:focus::-ms-fill-upper {
      background: #b5b6ff;
    }

   #recButton {
      margin: auto;
      font-family: Monospace;
      width: 805px;
      padding: 10px 0px;
      font-size: 24px;
      background-color: #b5b6ff;
   }
  </style>
  <script src="WebAudio Csound_files/CsoundObj.js"></script>
  <script>
    let count = 0;
    let csoundObj;
    const TEST_CSD =
    `
    <CsoundSynthesizer>
    <CsOptions>
    </CsOptions>
    <CsInstruments>

    sr = 44100
    ksmps = 32
    nchnls = 2
    nchnls_i = 1
    0dbfs = 1

    instr 103
    kf6 chnget "rec"
    ktrig changed kf6
    if ktrig==1 then

    turnoff2 4, 0, 1
    event "i", 3, 0, 3
    endif

    endin

    instr 3



    krelease release
    if krelease==1 then
    event "i", 4, 0, 1000
    endif

    ain inch 1
    andx line 0, p3, ftlen(giBuffer)
    tablew ain, andx, giBuffer

    endin

    instr 4

    chnset 1.0, "grain"
    chnset 1.0, "kstr"

    kf7 chnget "granAmp"
    kf8 chnget "kstr"
    kf9 chnget "grain"
    kf10 chnget "start"

    kfreq = 1
    kgrsize = 1

    iolaps = 2

    kgrsize = 1/kf9
    kfreq = iolaps/kgrsize
    kps = 1/iolaps


    kstr = 1/kf8
    kpitch = 1

    asig syncloop kf7, kfreq, kpitch, kgrsize, kps*kstr, kf10, 2.5, giBuffer, 2, iolaps
    gasrc = gasrc + asig*.5

    endin
    </CsInstruments>
      <CsScore>
      i103 0 36000

    </CsScore>
    </CsoundSynthesizer>
    `;

    CsoundObj.importScripts("./js/").then(() => {
      csoundObj = new CsoundObj();
      csoundObj.enableAudioInput((res) => {
        if (res) {
          csoundObj.setMessageCallback((msg) => {
            var element = document.getElementById('console');
            element.value += "\n" + msg;
            element.scrollTop = 99999; // focus on bottom
            count += 1;
            if (count == 1000) {
              element.value = ' ';
              count = 0;
            }
          });
          document.getElementById('recButton').addEventListener('click',
            click_this);
          document.getElementById('recButton').disabled = false;
          //CSOUND_AUDIO_CONTEXT.suspend();
          csoundObj.compileCSD(TEST_CSD);
          csoundObj.start();
        } else {
          alert("Unable to start microphone.");
        }
      });
    });

    var playing = false;

    function click_this() {
      if (playing == false) {
        csoundObj.setControlChannel("rec", 1);
        document.getElementById('recButton').innerText = "off";
        playing = true;
      } else {
        csoundObj.setControlChannel("rec", 0);
        document.getElementById('recButton').innerText = "on";
        playing = false;
      }
    }

    function attachLiisteners() {
      document.getElementById("amp")
      addEventListener("input", SetAmp);
    }

    function SetAmp() {
      SetParam('granAmp', '', 1., 0.0);
    }

    function SetSeed() {
      SetParam("kstr", '', 1., 0.0);
    }

    function SetGrain() {
      SetParam("grain", '', 1., 0.0);
    }

    function SetStart() {
      SetParam("start", '', 0., 5.0);
    }

    function SetParam(name, label, scal, off) {
      var val = document.getElementById(name).value / scal + off;
      csound.setControlChannel(name, val);
      console.log(name + ": " + val + " " + label);
    }

  </script><script src="WebAudio Csound_files/CsoundNode.js"></script>
</head>

<body>
  <h1>Syncloop</h1>
  <textarea class="console" rows="24" id="console">Csound: loading...</textarea>
  <div id="controls">
    <p>
      <input type="range" name="amplitude" id="amp" step="0.01" value="0.5" min="0" max="1"> amplitude </p>
    <p>
      <input type="range" name="seed" id="seed" step="0.01" value="0.1" min="0" max="1"> seed </p>
    <p>
      <input type="range" name="grain" id="grain" step="0.01" value="0.1" min="0" max="1"> grain size </p>
    <p>
      <input type="range" name="start" id="start" step="0.01" value="1" min="0" max="5"> start point </p>
  </div>
  <p>
    <button id="recButton">record</button>
>>>>>>> b5551c6b83c0e6b849c608f8b231c4a50717ac29
  </p>



<<<<<<< HEAD

=======
>>>>>>> b5551c6b83c0e6b849c608f8b231c4a50717ac29
</body></html>